(()=>{var p="";try{let e=window.location.hostname;p=window.location.origin}catch{p=""}async function I(){let e=await fetch(`${p}/books`,{headers:{Accept:"application/json"}});if(!e.ok)throw new Error(`fetchBooks failed: ${e.status} ${e.statusText}`);if((e.headers.get("content-type")||"").includes("text/html"))throw new Error("fetchBooks returned HTML instead of JSON");return e.json()}async function P(e){let t=await fetch(`${p}/books/${e}/chapters`,{headers:{Accept:"application/json"}});if(!t.ok)throw new Error(`fetchChapters failed: ${t.status} ${t.statusText}`);if((t.headers.get("content-type")||"").includes("text/html"))throw new Error("fetchChapters returned HTML instead of JSON");return t.json()}async function q(e){let t=await fetch(`${p}/chapters/${e}/verses`,{headers:{Accept:"application/json"}});if(!t.ok)throw new Error(`fetchVerses failed: ${t.status} ${t.statusText}`);if((t.headers.get("content-type")||"").includes("text/html"))throw new Error("fetchVerses returned HTML instead of JSON");return t.json()}async function j(e){let t=await fetch(`${p}/verses/${e}/words`,{headers:{Accept:"application/json"}});if(!t.ok)throw new Error(`fetchWords failed: ${t.status} ${t.statusText}`);if((t.headers.get("content-type")||"").includes("text/html"))throw new Error("fetchWords returned HTML instead of JSON");return t.json()}async function G(e){return(await fetch(`${p}/relations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json()}async function H(e){let t=await fetch(`${p}/verse/${e}`,{headers:{Accept:"application/json"}});if(!t.ok)throw new Error(`fetchVerse failed: ${t.status} ${t.statusText}`);if((t.headers.get("content-type")||"").includes("text/html"))throw new Error("fetchVerse returned HTML instead of JSON");return t.json()}async function z(e){let t=await fetch(`${p}/words/${encodeURIComponent(e)}/relations`,{headers:{Accept:"application/json"}});if(!t.ok)throw new Error(`fetchRelations failed: ${t.status} ${t.statusText}`);if((t.headers.get("content-type")||"").includes("text/html"))throw new Error("fetchRelations returned HTML instead of JSON");return t.json()}async function K(){let e=await fetch(`${p}/relation_types`,{headers:{Accept:"application/json"}});if(!e.ok)throw new Error(`fetchRelationTypes failed: ${e.status} ${e.statusText}`);if((e.headers.get("content-type")||"").includes("text/html"))throw new Error("fetchRelationTypes returned HTML instead of JSON");return e.json()}async function X(e){let t=await fetch(`${p}/relations/grouped/${encodeURIComponent(e)}`,{headers:{Accept:"application/json"}});if(!t.ok)throw new Error(`fetchGroupedRelations failed: ${t.status} ${t.statusText}`);if((t.headers.get("content-type")||"").includes("text/html"))throw new Error("fetchGroupedRelations returned HTML instead of JSON");return t.json()}async function Y(e){if(!Array.isArray(e)||e.length===0)return{};let t=e.join(","),r=await fetch(`${p}/relations/batch?ids=${encodeURIComponent(t)}`,{headers:{Accept:"application/json"}});if(!r.ok)throw new Error(`fetchRelationsBatch failed: ${r.status} ${r.statusText}`);if((r.headers.get("content-type")||"").includes("text/html"))throw new Error("fetchRelationsBatch returned HTML instead of JSON");return r.json()}async function Z(e){if(!Array.isArray(e)||e.length===0)return{};let t=e.join(","),r=await fetch(`${p}/relations/counts?ids=${encodeURIComponent(t)}`,{headers:{Accept:"application/json"}});if(!r.ok)throw new Error(`fetchRelationsCounts failed: ${r.status} ${r.statusText}`);if((r.headers.get("content-type")||"").includes("text/html"))throw new Error("fetchRelationsCounts returned HTML instead of JSON");return r.json()}async function N(e){let t=await fetch(`${p}/chapter/${e}`,{headers:{Accept:"application/json"}});if(!t.ok)throw new Error(`fetchChapter failed: ${t.status} ${t.statusText}`);if((t.headers.get("content-type")||"").includes("text/html"))throw new Error("fetchChapter returned HTML instead of JSON");return t.json()}async function O(e){let t=await fetch(`${p}/words/${encodeURIComponent(e)}/detail`);if(!t.ok)throw new Error("Failed to fetch word detail");return t.json()}async function Q(e){let t=await fetch(`${p}/relations/${e}`,{method:"DELETE"});if(!t.ok)throw new Error("Failed to delete relation");return t.json()}function ue(e){try{return e.normalize("NFD").replace(/\p{M}/gu,"")}catch{return e}}function U(e){if(!e)return"";let t=ue(e.toLowerCase()),r={\u03B1:"a",\u03B2:"b",\u03B3:"g",\u03B4:"d",\u03B5:"e",\u03B6:"z",\u03B7:"e",\u03B8:"th",\u03B9:"i",\u03BA:"k",\u03BB:"l",\u03BC:"m",\u03BD:"n",\u03BE:"x",\u03BF:"o",\u03C0:"p",\u03C1:"r",\u03C3:"s",\u03C2:"s",\u03C4:"t",\u03C5:"u",\u03C6:"ph",\u03C7:"ch",\u03C8:"ps",\u03C9:"o"},n="";for(let a of t)n+=r[a]!==void 0?r[a]:/[a-z0-9]/.test(a)?a:"";return n=n.replace(/uu/g,"u").replace(/phh/g,"ph"),n}function F(e){if(!e)return"";let t=e.normalize("NFD"),r={\u05D0:"",\u05D1:"b",\u05D2:"g",\u05D3:"d",\u05D4:"h",\u05D5:"v",\u05D6:"z",\u05D7:"ch",\u05D8:"t",\u05D9:"y",\u05DB:"k",\u05DA:"k",\u05DC:"l",\u05DE:"m",\u05DD:"m",\u05E0:"n",\u05E1:"s",\u05E2:"",\u05E3:"p",\u05E4:"p",\u05E5:"ts",\u05E6:"ts",\u05E7:"q",\u05E8:"r",\u05E9:"sh",\u05EA:"t"},n={"\u05B0":"e","\u05B1":"e","\u05B2":"a","\u05B3":"a","\u05B4":"i","\u05B5":"e","\u05B6":"e","\u05B7":"a","\u05B8":"a","\u05B9":"o","\u05BB":"u","\u05C7":"o"},a="\u05C1",o="\u05C2",s=[],i=-1;for(let l=0;l<t.length;l++){let d=t[l];/\u05D0-\u05EA/.test(d);let u=d.codePointAt(0);if(u>=1488&&u<=1514){let C=r[d]!==void 0?r[d]:"";s.push(C),i=s.length-1;continue}if(n[d]){i>=0?s[i]=s[i]+n[d]:(s.push(n[d]),i=s.length-1);continue}if(d===o){i>=0&&s[i].endsWith("sh")&&(s[i]=s[i].slice(0,-2)+"s");continue}if(d===a){i>=0&&s[i].endsWith("s")&&(s[i]=s[i]+"h");continue}/[A-Za-z0-9]/.test(d)&&(s.push(d),i=s.length-1)}let c=s.join(" ").replace(/\s+/g," ").trim();return c=c.replace(/''/g,"'"),c.toLowerCase()}function ee(e){if(!e)return"";try{if(/\p{Script=Greek}/u.test(e))return U(e);if(/\p{Script=Hebrew}/u.test(e))return F(e)}catch{if(/[\u0370-\u03FF]/.test(e))return U(e);if(/[\u0590-\u05FF]/.test(e))return F(e)}return""}function B(e){return e==null?"":String(e).replace(/[&<>\"]+/g,function(t){switch(t){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";default:return""}})}function M(e,t){if(!Array.isArray(e))return[];let r=e.length;if(r<=t)return e.slice();let n=[],a=new Set;for(;n.length<t;){let o=Math.floor(Math.random()*r);a.has(o)||(a.add(o),n.push(e[o]))}return n}function te(e){let t=document.createElement("div");return t.id="word-tooltip",t.classList.add("static"),t.setAttribute("role","status"),t.setAttribute("aria-live","polite"),e&&e.appendChild(t),{el:t,show(r){t.innerHTML=r||"",t.classList.add("show")},hide(){t.classList.remove("show")},append(r){t.innerHTML=(t.innerHTML||"")+r,t.classList.add("show")}}}function ne(e,t,r){let n=e.length?"<ul>"+e.map(o=>`<li>${r(o)}</li>`).join("")+"</ul>":"<div>-</div>",a=t.length?"<ul>"+t.map(o=>`<li>${r(o)}</li>`).join("")+"</ul>":"<div>-</div>";return`<div class="tooltip-grid"><div class="tooltip-col"><h4>Translations</h4>${n}</div><div class="tooltip-col"><h4>Originals</h4>${a}</div></div>`}function re(){return'<div style="margin-top:6px;font-size:.9rem;color:var(--muted)"><strong>Keyboard</strong><ul style="margin:6px 0 0 1rem;padding:0"><li>Alt+S \u2014 focus Source input</li><li>Alt+T \u2014 focus Target input</li><li>Alt+R \u2014 focus Relation type</li><li>Alt+Enter \u2014 Add Relation</li></ul></div>'}function ae(e,t,r){let n=!1;e&&e.addEventListener("click",a=>{if(a.preventDefault(),n=!n,n){let o=r&&typeof r=="function"?r():t.buildShortcutHtml?t.buildShortcutHtml():"";t.append(o),e.setAttribute("aria-pressed","true")}else t.hide(),e.setAttribute("aria-pressed","false")}),document.addEventListener("keydown",a=>{if(!a.altKey)return;let o=a.key.toLowerCase();o==="s"?(a.preventDefault(),document.getElementById("src")?.focus()):o==="t"?(a.preventDefault(),document.getElementById("tgt")?.focus()):o==="r"?(a.preventDefault(),document.getElementById("type")?.focus()):a.key==="Enter"&&(a.preventDefault(),document.getElementById("addRel")?.click())})}var f=document.getElementById("books"),y=document.getElementById("chapters"),g=document.getElementById("verses"),R=document.getElementById("words"),h=document.getElementById("result"),oe=document.getElementById("next-chapter"),se=document.getElementById("next-verse"),b=document.getElementById("loading-status"),w=[],m=[],pe=ee;async function he(){try{await(void 0)(e=>{b&&(b.textContent=e)}),b&&(b.style.display="none"),le()}catch(e){console.error("DB init failed",e),b&&(b.textContent="Failed to initialise database: "+String(e)),h&&(h.textContent="Failed to initialise database: "+String(e))}}he();function fe(){return window.location.hash.replace(/^#/,"")||"/"}function x(e){history.pushState(null,"","#"+e)}function me(){let e=fe().split("/").filter(Boolean),t={chapterId:null,verseId:null,bookId:null};return e.length>=2&&e[0]==="chapter"?t.chapterId=Number(e[1]):e.length>=2&&e[0]==="verse"?t.verseId=Number(e[1]):e.length>=4&&e[0]==="book"&&(t.bookId=Number(e[1]),e[2]==="chapter"&&(t.chapterId=Number(e[3])),e.length>=6&&e[4]==="verse"&&(t.verseId=Number(e[5]))),t}window.addEventListener("hashchange",()=>le());async function A(){let e=await I();f.innerHTML="",e.forEach(t=>{let r=document.createElement("option");r.value=t.id,r.textContent=t.name,f.appendChild(r)}),e[0]&&await $(e[0].id)}f.addEventListener("change",async()=>{let e=Number(f.value);if(!e)return;await $(e);let t=w[0];t&&x(`/chapter/${t.id}`)});async function $(e){let t=await P(e);w=Array.isArray(t)?t:[],y.innerHTML="",w.forEach(r=>{let n=document.createElement("option");n.value=String(r.number),n.textContent=r.number,y.appendChild(n)}),w[0]&&await v(w[0].id)}async function v(e,t={selectVerseId:null,showWholeChapter:!1}){let r=await q(e);if(m=Array.isArray(r)?r:[],g.innerHTML="",m.forEach(n=>{let a=document.createElement("option");a.value=String(n.number),a.textContent=n.number,g.appendChild(a)}),t&&t.selectVerseId){let n=m.find(a=>Number(a.id)===Number(t.selectVerseId));if(n){g.value=String(n.number),await L(Number(n.id));return}}if(t&&t.selectVerseNumber){let n=m.find(a=>Number(a.number)===Number(t.selectVerseNumber));if(n){g.value=String(n.number),await L(Number(n.id));return}}if(t.showWholeChapter){R.innerHTML="";let n=document.createElement("div");n.className="chapter-view",R.appendChild(n);let a=r.map(o=>{let s=document.createElement("div");s.className="verse-block";let i=document.createElement("h4"),c=document.createElement("a");c.href=`#/verse/${o.id}`,c.textContent=`Verse ${o.number}`,c.addEventListener("click",async d=>{d.preventDefault(),await v(e,{selectVerseId:o.id,showWholeChapter:!1}),x(`/verse/${o.id}`)}),i.appendChild(c),s.appendChild(i);let l=document.createElement("div");return l.id=`verse-${o.id}`,s.appendChild(l),n.appendChild(s),{id:o.id,wrapper:l}});await Promise.all(a.map(async o=>{let s=await j(o.id),i=document.createElement("ul");i.className="verse-words",s.forEach(c=>{let l=document.createElement("li"),d=ie(c);l.appendChild(d),i.appendChild(l)}),o.wrapper.appendChild(i);try{await V(s.map(c=>c.strong).filter(Boolean))}catch{}}));return}m[0]&&await L(m[0].id)}function ie(e){let t=e.verse_original||"",r=e.verse_translation||"",n=document.createElement("div");n.className="word-box word-main selectable",n.tabIndex=0,n.setAttribute("role","button"),n.setAttribute("draggable","true"),n.setAttribute("aria-label",(r||t||e.strong)+" \u2014 strong "+(e.strong||"")),n.dataset.strong=e.strong||"",n.dataset.allOriginals=JSON.stringify(Array.isArray(e.all_originals)?e.all_originals:[]),n.dataset.allTranslations=JSON.stringify(Array.isArray(e.all_translations)?e.all_translations:[]);let a=pe(t||"");if(a){let i=document.createElement("div");i.className="word-translit",i.textContent=a,n.appendChild(i)}let o=document.createElement("div");o.className="word-english",o.textContent=r||"",n.appendChild(o);let s=document.createElement("div");return s.className="word-original",s.textContent=t||(r?"":e.strong||"(no text)"),n.appendChild(s),n.addEventListener("dragstart",i=>{try{i.dataTransfer.setData("text/plain",e.strong||"")}catch{}n.dataset.draggedAt=String(Date.now()),n.classList.add("dragging")}),n.addEventListener("dragend",()=>{setTimeout(()=>{n.classList.remove("dragging"),n.dataset.draggedAt=""},50)}),n.addEventListener("keydown",i=>{if(i.key==="Enter")window.open("strong.html#"+encodeURIComponent(e.strong),"_blank");else if(i.key===" "){i.preventDefault(),n.classList.toggle("selected");let c=Array.from(document.querySelectorAll(".word-box.selected"));c.length===1?document.getElementById("src").value=c[0].dataset.strong||"":c.length===2&&(document.getElementById("src").value=c[0].dataset.strong||"",document.getElementById("tgt").value=c[1].dataset.strong||"")}}),n.addEventListener("click",()=>{let i=Number(n.dataset.draggedAt||0);i&&Date.now()-i<300||window.open("strong.html#"+encodeURIComponent(e.strong),"_blank")}),n}async function L(e){let t=await j(e);R.innerHTML="",t.forEach(r=>{let n=document.createElement("li");n.appendChild(ie(r)),R.appendChild(n)});try{await V(t.map(r=>r.strong).filter(Boolean))}catch{}}async function V(e){if(!(!Array.isArray(e)||e.length===0))try{let t=await Y(e),r={};try{r=await Z(e)}catch{r={}}for(let n of e){let a=!!t[n],o=document.querySelectorAll(`.word-box[data-strong="${CSS.escape(n)}"]`),s=r[n]?Number(r[n]):0;o.forEach(i=>{a?i.classList.add("has-relation"):i.classList.remove("has-relation");let c=i.querySelector(".relation-badge");s>0?(c||(c=document.createElement("div"),c.className="relation-badge",i.appendChild(c)),c.textContent=String(s)):c&&c.remove()})}}catch{}}var _=document.getElementById("add-relation-panel"),D=document.getElementById("relations-panel");function ce(e){e.preventDefault()}function ge(e){e.preventDefault();let t=e.dataTransfer.getData("text/plain");if(!t)return;let r=document.getElementById("src"),n=document.getElementById("tgt"),a=!1;try{let o=document.elementFromPoint(e.clientX,e.clientY),s=o&&o.closest?o.closest("input"):null;s===n?(n.value=t,a=!0):s===r&&(r.value=t,a=!0)}catch{}if(!a){let o=document.activeElement;o===n||o===r?o.value=t:r.value=t}_.classList.add("drop-target"),setTimeout(()=>_.classList.remove("drop-target"),350)}function we(e){e.preventDefault();let t=e.dataTransfer.getData("text/plain");t&&(document.getElementById("relations-strong").value=t,document.getElementById("showRelations").click(),D.classList.add("drop-target"),setTimeout(()=>D.classList.remove("drop-target"),350))}_.addEventListener("dragover",ce);_.addEventListener("drop",ge);D.addEventListener("dragover",ce);D.addEventListener("drop",we);document.getElementById("showRelations").addEventListener("click",async()=>{let e=document.getElementById("relations-strong").value.trim();if(!e)return;let t=await X(e),r=document.getElementById("relations-list");r.innerHTML="";for(let n of t){let a=document.createElement("li"),o=document.createElement("div"),s=n.source_id,i=n.target_id;try{let[l,d]=await Promise.allSettled([O(n.source_id),O(n.target_id)]);if(l.status==="fulfilled"&&l.value){let u=l.value;s=Array.isArray(u.all_originals)&&u.all_originals[0]||Array.isArray(u.all_translations)&&u.all_translations[0]||n.source_id}if(d.status==="fulfilled"&&d.value){let u=d.value;i=Array.isArray(u.all_originals)&&u.all_originals[0]||Array.isArray(u.all_translations)&&u.all_translations[0]||n.target_id}}catch{}if(o.textContent=`${n.relation_type}: ${s} (${n.source_id}) \u2192 ${i} (${n.target_id})`,a.appendChild(o),n.source_verse_ids&&n.source_verse_ids.length){let l=document.createElement("div");l.style.marginTop=".25rem",n.source_verse_ids.forEach(d=>{let u=document.createElement("button");u.textContent=`(Source: Link) ${d}`,u.style.marginRight="6px",u.addEventListener("click",async()=>{let C=await H(d);if(!C)return;let S=await N(C.chapter_id);S&&(await $(S.book_id),setTimeout(async()=>{let J=w.find(T=>Number(T.id)===Number(S.id));if(J){y.value=String(J.number),await v(S.id);let T=m.find(de=>Number(de.id)===Number(C.id));T&&(g.value=String(T.number))}},150))}),l.appendChild(u)}),a.appendChild(l)}let c=document.createElement("button");c.textContent="Remove",c.style.marginLeft="8px",c.addEventListener("click",async()=>{if(confirm("Remove this relation group? This will delete matching relations individually."))try{let d=(await z(n.source_id)).filter(u=>u.source_id===n.source_id&&u.target_id===n.target_id&&u.relation_type===n.relation_type);for(let u of d)await Q(u.id);document.getElementById("showRelations").click(),await W()}catch(l){alert("Failed to remove relation(s): "+String(l))}}),a.appendChild(c),r.appendChild(a)}});var ye=document.getElementById("add-relation-panel"),k=te(ye);function Ee(e){let t=e.target.closest?e.target.closest(".word-main"):e.target;if(t){let r=[],n=[];try{r=JSON.parse(t.dataset.allOriginals||"[]")}catch{}try{n=JSON.parse(t.dataset.allTranslations||"[]")}catch{}let a=ne(M(n,10),M(r,10),B);k.show(a)}}function ve(e){let t=e.target,r=e.relatedTarget,n=t&&t.closest?t.closest(".word-main"):null,a=r&&r.closest?r.closest(".word-main"):null;n&&n===a||n&&k.hide()}document.body.addEventListener("mouseover",Ee);document.body.addEventListener("mouseout",ve);ae(document.getElementById("shortcutInfo"),k,re);document.body.addEventListener("focusin",e=>{let t=e.target;if(t&&t.classList&&t.classList.contains("word-main")){let r=[],n=[];try{r=JSON.parse(t.dataset.allOriginals||"[]")}catch{}try{n=JSON.parse(t.dataset.allTranslations||"[]")}catch{}let a=n.length?"<ul>"+n.map(s=>`<li>${B(s)}</li>`).join("")+"</ul>":"<div>-</div>",o=r.length?"<ul>"+r.map(s=>`<li>${B(s)}</li>`).join("")+"</ul>":"<div>-</div>";k.show(`<div class="tooltip-grid"><div class="tooltip-col"><h4>Translations</h4>${a}</div><div class="tooltip-col"><h4>Originals</h4>${o}</div></div>`)}});document.body.addEventListener("focusout",e=>{let t=e.target;t&&t.classList&&t.classList.contains("word-main")&&k.hide()});y.addEventListener("change",async()=>{let e=Number(y.value),t=w.find(r=>Number(r.number)===e);t&&(await v(t.id,{selectVerseId:null,showWholeChapter:!0}),x(`/chapter/${t.id}`))});async function be(){let e=Number(y.value)||0,t=w.find(r=>Number(r.number)===e+1);t&&(y.value=String(t.number),await v(t.id,{selectVerseId:null,showWholeChapter:!0}),x(`/chapter/${t.id}`))}async function xe(){let e=Number(g.value)||0,t=m.find(r=>Number(r.number)===e+1);t&&(g.value=String(t.number),await L(t.id),x(`/verse/${t.id}`))}oe&&oe.addEventListener("click",async e=>{e.preventDefault(),await be()});se&&se.addEventListener("click",async e=>{e.preventDefault(),await xe()});g.addEventListener("change",async()=>{let e=Number(g.value),t=m.find(r=>Number(r.number)===e);t&&(await L(t.id),x(`/verse/${t.id}`))});document.getElementById("addRel").addEventListener("click",async()=>{let e=document.getElementById("src"),t=document.getElementById("tgt"),r=document.getElementById("type"),n=e&&e.value?e.value:"",a=t&&t.value?t.value:"",o=r&&r.value?r.value.trim():"";if(!n||!a){h.textContent="Please select source and target words";return}if(!o){h.textContent="Please enter or select a relation type";return}let s={source_id:n,target_id:a,relation_type:o},i=Number(g.value||0),c=m.find(l=>Number(l.number)===i);c&&(s.source_verse_id=c.id);try{let l=await G(s);h.textContent="Relation added: "+JSON.stringify(l),await W(),document.querySelectorAll(".word-box.selected").forEach(d=>d.classList.remove("selected")),e.value="",t.value=""}catch(l){h.textContent="Error adding relation: "+String(l)}});document.getElementById("exportRelations").addEventListener("click",async()=>{try{let e=await(void 0)(),t=new Blob([e],{type:"application/json"}),r=URL.createObjectURL(t),n=document.createElement("a");n.href=r,n.download="parallelismus-relations.json",n.click(),URL.revokeObjectURL(r),h.textContent="Relations exported."}catch(e){h.textContent="Export failed: "+String(e)}});document.getElementById("importRelations").addEventListener("click",()=>{let e=document.createElement("input");e.type="file",e.accept=".json",e.addEventListener("change",async()=>{let t=e.files[0];if(t)try{let r=await t.text(),n=await(void 0)(r);h.textContent=`Imported ${n} relations. Reloading\u2026`,await W();let a=Array.from(document.querySelectorAll(".word-box[data-strong]")).map(o=>o.dataset.strong).filter(Boolean);await V([...new Set(a)])}catch(r){h.textContent="Import failed: "+String(r)}}),e.click()});async function le(){let e=me();if(!e.chapterId&&!e.verseId){await A();return}if(e.chapterId){let t=await N(e.chapterId);if(!t){await A();return}let r=await I();f.innerHTML="",r.forEach(a=>{let o=document.createElement("option");o.value=a.id,o.textContent=a.name,f.appendChild(o)}),f.value=String(t.book_id),await $(t.book_id);let n=w.find(a=>Number(a.id)===Number(e.chapterId));n&&(y.value=String(n.number),await v(n.id,{selectVerseId:e.verseId||null,showWholeChapter:!e.verseId}));return}if(e.verseId){let t=await H(e.verseId);if(!t){await A();return}let r=await N(t.chapter_id);if(!r){await A();return}let n=await I();f.innerHTML="",n.forEach(o=>{let s=document.createElement("option");s.value=o.id,s.textContent=o.name,f.appendChild(s)}),f.value=String(r.book_id),await $(r.book_id);let a=w.find(o=>Number(o.id)===Number(r.id));a&&(y.value=String(a.number),await v(r.id,{selectVerseId:e.verseId,showWholeChapter:!1}));return}}async function W(){let e=await K(),t=document.getElementById("relation-types");t.innerHTML=e.map(r=>`<option value="${r}"></option>`).join("")}window.addEventListener("error",e=>{console.error("Unhandled error",e.error||e.message,e),h&&(h.textContent="Runtime error: "+String(e.error||e.message))});window.addEventListener("unhandledrejection",e=>{console.error("Unhandled rejection",e.reason),h&&(h.textContent="Unhandled promise rejection: "+String(e.reason))});var Be={};})();
