(()=>{var me=(function(){try{if(window.__PARALLELISMUS_BASE__)return window.__PARALLELISMUS_BASE__;if(document.currentScript&&document.currentScript.src)return new URL("./",document.currentScript.src).href}catch{}return""})(),ue=me+"data/bible-index.json";function Le(e){return me+"data/chapters/"+e+".json"}var z=[],T=[],G=[],$={},E={},x={},J={},D={},Se="parallelismus",Ne=2,v=null;function ke(){return new Promise((e,t)=>{let r=indexedDB.open(Se,Ne);r.onupgradeneeded=n=>{let o=n.target.result;for(let a of["books","chapters","verses","verseWords","words"])o.objectStoreNames.contains(a)&&o.deleteObjectStore(a);if(!o.objectStoreNames.contains("relations")){let a=o.createObjectStore("relations",{keyPath:"id",autoIncrement:!0});a.createIndex("source_id","source_id",{unique:!1}),a.createIndex("target_id","target_id",{unique:!1})}},r.onsuccess=()=>e(r.result),r.onerror=()=>t(r.error)})}var I=null;async function X(e){return I||(I=(async()=>{e&&e("Loading bible index\u2026");let t=await fetch(ue);if(!t.ok)throw new Error(`Failed to fetch ${ue}: ${t.status}`);let r=await t.json();z=r.books,T=r.chapters,G=r.verses,$={};for(let n of r.words)$[n.strong]=n;E={};for(let n of T)E[n.book_id]||(E[n.book_id]=[]),E[n.book_id].push(n);x={},J={};for(let n of G)x[n.chapter_id]||(x[n.chapter_id]=[]),x[n.chapter_id].push(n),J[n.id]=n.chapter_id;v=await ke(),e&&e("Ready.")})(),I)}async function Be(e){if(D[e])return D[e];let t=await fetch(Le(e));if(!t.ok)throw new Error(`Failed to fetch chapter ${e}: ${t.status}`);let r=await t.json();return D[e]=r,r}async function C(){return z}async function K(e){return E[Number(e)]||[]}async function Y(e){return x[Number(e)]||[]}async function j(e){let t=J[Number(e)];if(t==null)return[];let n=(await Be(t)).verses.find(o=>o.id===Number(e));return!n||!n.words?[]:n.words.map(o=>{let a=o[0],i=$[a];return{strong:a,verse_original:o[1]||"",verse_translation:o[2]||"",all_originals:i?i.original:[],all_translations:i?i.translation:[]}})}async function O(e){return G.find(t=>t.id===Number(e))||null}async function L(e){let t=T.find(r=>r.id===Number(e));if(!t)throw new Error("Chapter not found");return t}async function V(e){let t=$[e];if(!t)throw new Error("Word not found");let r=[];for(let[n,o]of Object.entries(D)){let a=T.find(s=>s.id===Number(n));if(!a)continue;let i=z.find(s=>s.id===a.book_id);for(let s of o.verses)for(let c of s.words)c[0]===e&&r.push({verse_id:s.id,verse_number:s.number,chapter_id:a.id,chapter_number:a.number,book_id:i?i.id:0,book_name:i?i.name:"",verse_original:c[1]||"",verse_translation:c[2]||""})}return{strong:t.strong,all_originals:t.original,all_translations:t.translation,usages:r}}function S(){return new Promise((e,t)=>{let n=v.transaction("relations","readonly").objectStore("relations").getAll();n.onsuccess=()=>e(n.result),n.onerror=()=>t(n.error)})}function Re(e){return new Promise((t,r)=>{let o=v.transaction("relations","readonly").objectStore("relations").get(e);o.onsuccess=()=>t(o.result),o.onerror=()=>r(o.error)})}async function Z(e){return new Promise((t,r)=>{let o=v.transaction("relations","readwrite").objectStore("relations"),a={source_id:e.source_id,target_id:e.target_id,relation_type:e.relation_type,source_verse_id:e.source_verse_id||null,notes:e.notes||null},i=o.add(a);i.onsuccess=()=>{a.id=i.result,t(a)},i.onerror=()=>r(i.error)})}async function Q(e){let t=await Re(Number(e));if(!t)throw new Error("Relation not found");return new Promise((r,n)=>{let o=v.transaction("relations","readwrite");o.objectStore("relations").delete(Number(e)),o.oncomplete=()=>r(t),o.onerror=()=>n(o.error)})}async function W(e){return(await S()).filter(r=>r.source_id===e||r.target_id===e)}async function ee(e){let t=await W(e),r={};for(let n of t){let o=`${n.source_id}|${n.target_id}|${n.relation_type}`;r[o]||(r[o]={source_id:n.source_id,target_id:n.target_id,relation_type:n.relation_type,source_verse_ids:new Set}),n.source_verse_id!=null&&r[o].source_verse_ids.add(n.source_verse_id)}return Object.values(r).map(n=>({...n,source_verse_ids:[...n.source_verse_ids].sort((o,a)=>o-a)}))}async function te(e){if(!Array.isArray(e)||e.length===0)return{};let t=await S(),r={};for(let n of e)r[n]=!1;for(let n of t)r.hasOwnProperty(n.source_id)&&(r[n.source_id]=!0),r.hasOwnProperty(n.target_id)&&(r[n.target_id]=!0);return r}async function ne(e){if(!Array.isArray(e)||e.length===0)return{};let t=await S(),r={};for(let n of e)r[n]=0;for(let n of t)r.hasOwnProperty(n.source_id)&&r[n.source_id]++,r.hasOwnProperty(n.target_id)&&r[n.target_id]++;return r}async function re(){let e=await S(),t=new Set;for(let r of e)r.relation_type&&t.add(r.relation_type);return[...t].sort()}async function oe(){let e=await S();return JSON.stringify(e,null,2)}async function ae(e){let t=JSON.parse(e);if(!Array.isArray(t))throw new Error("Expected an array of relation objects");return await new Promise((r,n)=>{let o=v.transaction("relations","readwrite");o.objectStore("relations").clear(),o.oncomplete=()=>r(),o.onerror=()=>n(o.error)}),new Promise((r,n)=>{let o=v.transaction("relations","readwrite"),a=o.objectStore("relations");for(let i of t)a.put(i);o.oncomplete=()=>r(t.length),o.onerror=()=>n(o.error)})}function Ae(e){try{return e.normalize("NFD").replace(/\p{M}/gu,"")}catch{return e}}function fe(e){if(!e)return"";let t=Ae(e.toLowerCase()),r={\u03B1:"a",\u03B2:"b",\u03B3:"g",\u03B4:"d",\u03B5:"e",\u03B6:"z",\u03B7:"e",\u03B8:"th",\u03B9:"i",\u03BA:"k",\u03BB:"l",\u03BC:"m",\u03BD:"n",\u03BE:"x",\u03BF:"o",\u03C0:"p",\u03C1:"r",\u03C3:"s",\u03C2:"s",\u03C4:"t",\u03C5:"u",\u03C6:"ph",\u03C7:"ch",\u03C8:"ps",\u03C9:"o"},n="";for(let o of t)n+=r[o]!==void 0?r[o]:/[a-z0-9]/.test(o)?o:"";return n.replace(/uu/g,"u").replace(/phh/g,"ph")}function pe(e){if(!e)return"";let t=e.normalize("NFD"),r={\u05D0:"",\u05D1:"b",\u05D2:"g",\u05D3:"d",\u05D4:"h",\u05D5:"v",\u05D6:"z",\u05D7:"ch",\u05D8:"t",\u05D9:"y",\u05DB:"k",\u05DA:"k",\u05DC:"l",\u05DE:"m",\u05DD:"m",\u05E0:"n",\u05E1:"s",\u05E2:"",\u05E3:"p",\u05E4:"p",\u05E5:"ts",\u05E6:"ts",\u05E7:"q",\u05E8:"r",\u05E9:"sh",\u05EA:"t"},n={"\u05B0":"e","\u05B1":"e","\u05B2":"a","\u05B3":"a","\u05B4":"i","\u05B5":"e","\u05B6":"e","\u05B7":"a","\u05B8":"a","\u05B9":"o","\u05BB":"u","\u05C7":"o"},o="\u05C1",a="\u05C2",i=[],s=-1;for(let l=0;l<t.length;l++){let d=t[l],u=d.codePointAt(0);if(u>=1488&&u<=1514){i.push(r[d]!==void 0?r[d]:""),s=i.length-1;continue}if(n[d]){s>=0?i[s]+=n[d]:(i.push(n[d]),s=i.length-1);continue}if(d===a){s>=0&&i[s].endsWith("sh")&&(i[s]=i[s].slice(0,-2)+"s");continue}if(d===o){s>=0&&i[s].endsWith("s")&&(i[s]+="h");continue}/[A-Za-z0-9]/.test(d)&&(i.push(d),s=i.length-1)}return i.join(" ").replace(/\s+/g," ").trim().replace(/''/g,"'").toLowerCase()}function ie(e){if(!e)return"";try{if(/\p{Script=Greek}/u.test(e))return fe(e);if(/\p{Script=Hebrew}/u.test(e))return pe(e)}catch{if(/[\u0370-\u03FF]/.test(e))return fe(e);if(/[\u0590-\u05FF]/.test(e))return pe(e)}return""}function H(e){return e==null?"":String(e).replace(/[&<>\"]+/g,function(t){switch(t){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";default:return""}})}function se(e,t){if(!Array.isArray(e))return[];let r=e.length;if(r<=t)return e.slice();let n=[],o=new Set;for(;n.length<t;){let a=Math.floor(Math.random()*r);o.has(a)||(o.add(a),n.push(e[a]))}return n}function he(e){let t=document.createElement("div");return t.id="word-tooltip",t.classList.add("static"),t.setAttribute("role","status"),t.setAttribute("aria-live","polite"),e&&e.appendChild(t),{el:t,show(r){t.innerHTML=r||"",t.classList.add("show")},hide(){t.classList.remove("show")},append(r){t.innerHTML=(t.innerHTML||"")+r,t.classList.add("show")}}}function ge(e,t,r){let n=e.length?"<ul>"+e.map(a=>`<li>${r(a)}</li>`).join("")+"</ul>":"<div>-</div>",o=t.length?"<ul>"+t.map(a=>`<li>${r(a)}</li>`).join("")+"</ul>":"<div>-</div>";return`<div class="tooltip-grid"><div class="tooltip-col"><h4>Translations</h4>${n}</div><div class="tooltip-col"><h4>Originals</h4>${o}</div></div>`}function ye(){return'<div style="margin-top:6px;font-size:.9rem;color:var(--muted)"><strong>Keyboard</strong><ul style="margin:6px 0 0 1rem;padding:0"><li>Alt+S \u2014 focus Source input</li><li>Alt+T \u2014 focus Target input</li><li>Alt+R \u2014 focus Relation type</li><li>Alt+Enter \u2014 Add Relation</li></ul></div>'}function ve(e,t,r){let n=!1;e&&e.addEventListener("click",o=>{if(o.preventDefault(),n=!n,n){let a=r&&typeof r=="function"?r():t.buildShortcutHtml?t.buildShortcutHtml():"";t.append(a),e.setAttribute("aria-pressed","true")}else t.hide(),e.setAttribute("aria-pressed","false")}),document.addEventListener("keydown",o=>{if(!o.altKey)return;let a=o.key.toLowerCase();a==="s"?(o.preventDefault(),document.getElementById("src")?.focus()):a==="t"?(o.preventDefault(),document.getElementById("tgt")?.focus()):a==="r"?(o.preventDefault(),document.getElementById("type")?.focus()):o.key==="Enter"&&(o.preventDefault(),document.getElementById("addRel")?.click())})}var p=document.getElementById("books"),y=document.getElementById("chapters"),h=document.getElementById("verses"),P=document.getElementById("words"),f=document.getElementById("result"),we=document.getElementById("next-chapter"),be=document.getElementById("next-verse"),b=document.getElementById("loading-status"),g=[],m=[],De=ie;async function Te(){try{await X(e=>{b&&(b.textContent=e)}),b&&(b.style.display="none"),xe()}catch(e){console.error("DB init failed",e),b&&(b.textContent="Failed to initialise database: "+String(e)),f&&(f.textContent="Failed to initialise database: "+String(e))}}Te();function $e(){return window.location.hash.replace(/^#/,"")||"/"}function _(e){history.pushState(null,"","#"+e)}function je(){let e=$e().split("/").filter(Boolean),t={chapterId:null,verseId:null,bookId:null};return e.length>=2&&e[0]==="chapter"?t.chapterId=Number(e[1]):e.length>=2&&e[0]==="verse"?t.verseId=Number(e[1]):e.length>=4&&e[0]==="book"&&(t.bookId=Number(e[1]),e[2]==="chapter"&&(t.chapterId=Number(e[3])),e.length>=6&&e[4]==="verse"&&(t.verseId=Number(e[5]))),t}window.addEventListener("hashchange",()=>xe());async function M(){let e=await C();p.innerHTML="",e.forEach(t=>{let r=document.createElement("option");r.value=t.id,r.textContent=t.name,p.appendChild(r)}),e[0]&&await k(e[0].id)}p.addEventListener("change",async()=>{let e=Number(p.value);if(!e)return;await k(e);let t=g[0];t&&_(`/chapter/${t.id}`)});async function k(e){let t=await K(e);g=Array.isArray(t)?t:[],y.innerHTML="",g.forEach(r=>{let n=document.createElement("option");n.value=String(r.number),n.textContent=r.number,y.appendChild(n)}),g[0]&&await w(g[0].id)}async function w(e,t={selectVerseId:null,showWholeChapter:!1}){let r=await Y(e);if(m=Array.isArray(r)?r:[],h.innerHTML="",m.forEach(n=>{let o=document.createElement("option");o.value=String(n.number),o.textContent=n.number,h.appendChild(o)}),t&&t.selectVerseId){let n=m.find(o=>Number(o.id)===Number(t.selectVerseId));if(n){h.value=String(n.number),await N(Number(n.id));return}}if(t&&t.selectVerseNumber){let n=m.find(o=>Number(o.number)===Number(t.selectVerseNumber));if(n){h.value=String(n.number),await N(Number(n.id));return}}if(t.showWholeChapter){P.innerHTML="";let n=document.createElement("div");n.className="chapter-view",P.appendChild(n);let o=r.map(a=>{let i=document.createElement("div");i.className="verse-block";let s=document.createElement("h4"),c=document.createElement("a");c.href=`#/verse/${a.id}`,c.textContent=`Verse ${a.number}`,c.addEventListener("click",async d=>{d.preventDefault(),await w(e,{selectVerseId:a.id,showWholeChapter:!1}),_(`/verse/${a.id}`)}),s.appendChild(c),i.appendChild(s);let l=document.createElement("div");return l.id=`verse-${a.id}`,i.appendChild(l),n.appendChild(i),{id:a.id,wrapper:l}});await Promise.all(o.map(async a=>{let i=await j(a.id),s=document.createElement("ul");s.className="verse-words",i.forEach(c=>{let l=document.createElement("li"),d=_e(c);l.appendChild(d),s.appendChild(l)}),a.wrapper.appendChild(s);try{await ce(i.map(c=>c.strong).filter(Boolean))}catch{}}));return}m[0]&&await N(m[0].id)}function _e(e){let t=e.verse_original||"",r=e.verse_translation||"",n=document.createElement("div");n.className="word-box word-main selectable",n.tabIndex=0,n.setAttribute("role","button"),n.setAttribute("draggable","true"),n.setAttribute("aria-label",(r||t||e.strong)+" \u2014 strong "+(e.strong||"")),n.dataset.strong=e.strong||"",n.dataset.allOriginals=JSON.stringify(Array.isArray(e.all_originals)?e.all_originals:[]),n.dataset.allTranslations=JSON.stringify(Array.isArray(e.all_translations)?e.all_translations:[]);let o=De(t||"");if(o){let s=document.createElement("div");s.className="word-translit",s.textContent=o,n.appendChild(s)}let a=document.createElement("div");a.className="word-english",a.textContent=r||"",n.appendChild(a);let i=document.createElement("div");return i.className="word-original",i.textContent=t||(r?"":e.strong||"(no text)"),n.appendChild(i),n.addEventListener("dragstart",s=>{try{s.dataTransfer.setData("text/plain",e.strong||"")}catch{}n.dataset.draggedAt=String(Date.now()),n.classList.add("dragging")}),n.addEventListener("dragend",()=>{setTimeout(()=>{n.classList.remove("dragging"),n.dataset.draggedAt=""},50)}),n.addEventListener("keydown",s=>{if(s.key==="Enter")window.open("strong.html#"+encodeURIComponent(e.strong),"_blank");else if(s.key===" "){s.preventDefault(),n.classList.toggle("selected");let c=Array.from(document.querySelectorAll(".word-box.selected"));c.length===1?document.getElementById("src").value=c[0].dataset.strong||"":c.length===2&&(document.getElementById("src").value=c[0].dataset.strong||"",document.getElementById("tgt").value=c[1].dataset.strong||"")}}),n.addEventListener("click",()=>{let s=Number(n.dataset.draggedAt||0);s&&Date.now()-s<300||window.open("strong.html#"+encodeURIComponent(e.strong),"_blank")}),n}async function N(e){let t=await j(e);P.innerHTML="",t.forEach(r=>{let n=document.createElement("li");n.appendChild(_e(r)),P.appendChild(n)});try{await ce(t.map(r=>r.strong).filter(Boolean))}catch{}}async function ce(e){if(!(!Array.isArray(e)||e.length===0))try{let t=await te(e),r={};try{r=await ne(e)}catch{r={}}for(let n of e){let o=!!t[n],a=document.querySelectorAll(`.word-box[data-strong="${CSS.escape(n)}"]`),i=r[n]?Number(r[n]):0;a.forEach(s=>{o?s.classList.add("has-relation"):s.classList.remove("has-relation");let c=s.querySelector(".relation-badge");i>0?(c||(c=document.createElement("div"),c.className="relation-badge",s.appendChild(c)),c.textContent=String(i)):c&&c.remove()})}}catch{}}var U=document.getElementById("add-relation-panel"),q=document.getElementById("relations-panel");function Ee(e){e.preventDefault()}function Oe(e){e.preventDefault();let t=e.dataTransfer.getData("text/plain");if(!t)return;let r=document.getElementById("src"),n=document.getElementById("tgt"),o=!1;try{let a=document.elementFromPoint(e.clientX,e.clientY),i=a&&a.closest?a.closest("input"):null;i===n?(n.value=t,o=!0):i===r&&(r.value=t,o=!0)}catch{}if(!o){let a=document.activeElement;a===n||a===r?a.value=t:r.value=t}U.classList.add("drop-target"),setTimeout(()=>U.classList.remove("drop-target"),350)}function Ve(e){e.preventDefault();let t=e.dataTransfer.getData("text/plain");t&&(document.getElementById("relations-strong").value=t,document.getElementById("showRelations").click(),q.classList.add("drop-target"),setTimeout(()=>q.classList.remove("drop-target"),350))}U.addEventListener("dragover",Ee);U.addEventListener("drop",Oe);q.addEventListener("dragover",Ee);q.addEventListener("drop",Ve);document.getElementById("showRelations").addEventListener("click",async()=>{let e=document.getElementById("relations-strong").value.trim();if(!e)return;let t=await ee(e),r=document.getElementById("relations-list");r.innerHTML="";for(let n of t){let o=document.createElement("li"),a=document.createElement("div"),i=n.source_id,s=n.target_id;try{let[l,d]=await Promise.allSettled([V(n.source_id),V(n.target_id)]);if(l.status==="fulfilled"&&l.value){let u=l.value;i=Array.isArray(u.all_originals)&&u.all_originals[0]||Array.isArray(u.all_translations)&&u.all_translations[0]||n.source_id}if(d.status==="fulfilled"&&d.value){let u=d.value;s=Array.isArray(u.all_originals)&&u.all_originals[0]||Array.isArray(u.all_translations)&&u.all_translations[0]||n.target_id}}catch{}if(a.textContent=`${n.relation_type}: ${i} (${n.source_id}) \u2192 ${s} (${n.target_id})`,o.appendChild(a),n.source_verse_ids&&n.source_verse_ids.length){let l=document.createElement("div");l.style.marginTop=".25rem",n.source_verse_ids.forEach(d=>{let u=document.createElement("button");u.textContent=`(Source: Link) ${d}`,u.style.marginRight="6px",u.addEventListener("click",async()=>{let F=await O(d);if(!F)return;let R=await L(F.chapter_id);R&&(await k(R.book_id),setTimeout(async()=>{let de=g.find(A=>Number(A.id)===Number(R.id));if(de){y.value=String(de.number),await w(R.id);let A=m.find(Ce=>Number(Ce.id)===Number(F.id));A&&(h.value=String(A.number))}},150))}),l.appendChild(u)}),o.appendChild(l)}let c=document.createElement("button");c.textContent="Remove",c.style.marginLeft="8px",c.addEventListener("click",async()=>{if(confirm("Remove this relation group? This will delete matching relations individually."))try{let d=(await W(n.source_id)).filter(u=>u.source_id===n.source_id&&u.target_id===n.target_id&&u.relation_type===n.relation_type);for(let u of d)await Q(u.id);document.getElementById("showRelations").click(),await le()}catch(l){alert("Failed to remove relation(s): "+String(l))}}),o.appendChild(c),r.appendChild(o)}});var We=document.getElementById("add-relation-panel"),B=he(We);function He(e){let t=e.target.closest?e.target.closest(".word-main"):e.target;if(t){let r=[],n=[];try{r=JSON.parse(t.dataset.allOriginals||"[]")}catch{}try{n=JSON.parse(t.dataset.allTranslations||"[]")}catch{}let o=ge(se(n,10),se(r,10),H);B.show(o)}}function Me(e){let t=e.target,r=e.relatedTarget,n=t&&t.closest?t.closest(".word-main"):null,o=r&&r.closest?r.closest(".word-main"):null;n&&n===o||n&&B.hide()}document.body.addEventListener("mouseover",He);document.body.addEventListener("mouseout",Me);ve(document.getElementById("shortcutInfo"),B,ye);document.body.addEventListener("focusin",e=>{let t=e.target;if(t&&t.classList&&t.classList.contains("word-main")){let r=[],n=[];try{r=JSON.parse(t.dataset.allOriginals||"[]")}catch{}try{n=JSON.parse(t.dataset.allTranslations||"[]")}catch{}let o=n.length?"<ul>"+n.map(i=>`<li>${H(i)}</li>`).join("")+"</ul>":"<div>-</div>",a=r.length?"<ul>"+r.map(i=>`<li>${H(i)}</li>`).join("")+"</ul>":"<div>-</div>";B.show(`<div class="tooltip-grid"><div class="tooltip-col"><h4>Translations</h4>${o}</div><div class="tooltip-col"><h4>Originals</h4>${a}</div></div>`)}});document.body.addEventListener("focusout",e=>{let t=e.target;t&&t.classList&&t.classList.contains("word-main")&&B.hide()});y.addEventListener("change",async()=>{let e=Number(y.value),t=g.find(r=>Number(r.number)===e);t&&(await w(t.id,{selectVerseId:null,showWholeChapter:!0}),_(`/chapter/${t.id}`))});async function Pe(){let e=Number(y.value)||0,t=g.find(r=>Number(r.number)===e+1);t&&(y.value=String(t.number),await w(t.id,{selectVerseId:null,showWholeChapter:!0}),_(`/chapter/${t.id}`))}async function Ue(){let e=Number(h.value)||0,t=m.find(r=>Number(r.number)===e+1);t&&(h.value=String(t.number),await N(t.id),_(`/verse/${t.id}`))}we&&we.addEventListener("click",async e=>{e.preventDefault(),await Pe()});be&&be.addEventListener("click",async e=>{e.preventDefault(),await Ue()});h.addEventListener("change",async()=>{let e=Number(h.value),t=m.find(r=>Number(r.number)===e);t&&(await N(t.id),_(`/verse/${t.id}`))});document.getElementById("addRel").addEventListener("click",async()=>{let e=document.getElementById("src"),t=document.getElementById("tgt"),r=document.getElementById("type"),n=e&&e.value?e.value:"",o=t&&t.value?t.value:"",a=r&&r.value?r.value.trim():"";if(!n||!o){f.textContent="Please select source and target words";return}if(!a){f.textContent="Please enter or select a relation type";return}let i={source_id:n,target_id:o,relation_type:a},s=Number(h.value||0),c=m.find(l=>Number(l.number)===s);c&&(i.source_verse_id=c.id);try{let l=await Z(i);f.textContent="Relation added: "+JSON.stringify(l),await le(),document.querySelectorAll(".word-box.selected").forEach(d=>d.classList.remove("selected")),e.value="",t.value=""}catch(l){f.textContent="Error adding relation: "+String(l)}});document.getElementById("exportRelations").addEventListener("click",async()=>{try{let e=await oe(),t=new Blob([e],{type:"application/json"}),r=URL.createObjectURL(t),n=document.createElement("a");n.href=r,n.download="parallelismus-relations.json",n.click(),URL.revokeObjectURL(r),f.textContent="Relations exported."}catch(e){f.textContent="Export failed: "+String(e)}});document.getElementById("importRelations").addEventListener("click",()=>{let e=document.createElement("input");e.type="file",e.accept=".json",e.addEventListener("change",async()=>{let t=e.files[0];if(t)try{let r=await t.text(),n=await ae(r);f.textContent=`Imported ${n} relations. Reloading\u2026`,await le();let o=Array.from(document.querySelectorAll(".word-box[data-strong]")).map(a=>a.dataset.strong).filter(Boolean);await ce([...new Set(o)])}catch(r){f.textContent="Import failed: "+String(r)}}),e.click()});async function xe(){let e=je();if(!e.chapterId&&!e.verseId){await M();return}if(e.chapterId){let t=await L(e.chapterId);if(!t){await M();return}let r=await C();p.innerHTML="",r.forEach(o=>{let a=document.createElement("option");a.value=o.id,a.textContent=o.name,p.appendChild(a)}),p.value=String(t.book_id),await k(t.book_id);let n=g.find(o=>Number(o.id)===Number(e.chapterId));n&&(y.value=String(n.number),await w(n.id,{selectVerseId:e.verseId||null,showWholeChapter:!e.verseId}));return}if(e.verseId){let t=await O(e.verseId);if(!t){await M();return}let r=await L(t.chapter_id);if(!r){await M();return}let n=await C();p.innerHTML="",n.forEach(a=>{let i=document.createElement("option");i.value=a.id,i.textContent=a.name,p.appendChild(i)}),p.value=String(r.book_id),await k(r.book_id);let o=g.find(a=>Number(a.id)===Number(r.id));o&&(y.value=String(o.number),await w(r.id,{selectVerseId:e.verseId,showWholeChapter:!1}));return}}async function le(){let e=await re(),t=document.getElementById("relation-types");t.innerHTML=e.map(r=>`<option value="${r}"></option>`).join("")}window.addEventListener("error",e=>{console.error("Unhandled error",e.error||e.message,e),f&&(f.textContent="Runtime error: "+String(e.error||e.message))});window.addEventListener("unhandledrejection",e=>{console.error("Unhandled rejection",e.reason),f&&(f.textContent="Unhandled promise rejection: "+String(e.reason))});var rt={};})();
