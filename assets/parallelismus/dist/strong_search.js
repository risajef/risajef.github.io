(()=>{var S=(function(){try{if(window.__PARALLELISMUS_BASE__)return window.__PARALLELISMUS_BASE__;if(document.currentScript&&document.currentScript.src)return new URL("./",document.currentScript.src).href}catch{}return""})(),b=S+"data/bible-index.json";var C=[],x=[],v=[],p={},u={},l={},E={};var B="parallelismus",A=2,R=null;function k(){return new Promise((e,r)=>{let o=indexedDB.open(B,A);o.onupgradeneeded=t=>{let n=t.target.result;for(let i of["books","chapters","verses","verseWords","words"])n.objectStoreNames.contains(i)&&n.deleteObjectStore(i);if(!n.objectStoreNames.contains("relations")){let i=n.createObjectStore("relations",{keyPath:"id",autoIncrement:!0});i.createIndex("source_id","source_id",{unique:!1}),i.createIndex("target_id","target_id",{unique:!1})}},o.onsuccess=()=>e(o.result),o.onerror=()=>r(o.error)})}var f=null;async function h(e){return f||(f=(async()=>{e&&e("Loading bible index\u2026");let r=await fetch(b);if(!r.ok)throw new Error(`Failed to fetch ${b}: ${r.status}`);let o=await r.json();C=o.books,x=o.chapters,v=o.verses,p={};for(let t of o.words)p[t.strong]=t;u={};for(let t of x)u[t.book_id]||(u[t.book_id]=[]),u[t.book_id].push(t);l={},E={};for(let t of v)l[t.chapter_id]||(l[t.chapter_id]=[]),l[t.chapter_id].push(t),E[t.id]=t.chapter_id;R=await k(),e&&e("Ready.")})(),f)}async function _(e){let r=(e||"").trim().toLowerCase();if(!r)return[];let o=[];for(let t of Object.values(p)){let n=!1;for(let i of t.translation||[])if(i&&i.toLowerCase().includes(r)){n=!0;break}if(!n){for(let i of t.original||[])if(i&&i.toLowerCase().includes(r)){n=!0;break}}!n&&t.strong&&t.strong.toLowerCase().includes(r)&&(n=!0),n&&o.push({strong:t.strong,original:t.original,translation:t.translation})}return o}var g=document.getElementById("q"),j=document.getElementById("go"),s=document.getElementById("results"),a=document.getElementById("loading-status");(async()=>{try{await h(r=>{a&&(a.textContent=r)}),a&&(a.style.display="none");let e=new URLSearchParams(location.search);e.get("q")&&(g.value=e.get("q"),m())}catch(e){a&&(a.textContent="DB init failed: "+String(e))}})();async function m(){let e=(g.value||"").trim();if(!e){s.innerHTML="<div>Enter a query</div>";return}s.innerHTML="<div>Searching\u2026</div>";try{let r=await _(e);if(!r||!r.length){s.innerHTML="<div>(no results)</div>";return}let o=document.createElement("ul");r.forEach(t=>{let n=document.createElement("li"),i=document.createElement("div");i.style.fontWeight="600",i.textContent=t.strong,n.appendChild(i);let w=document.createElement("div");w.innerHTML=`<strong>Translations:</strong> ${Array.isArray(t.translation)?t.translation.slice(0,6).map(d=>D(d)).join(", "):""}`,n.appendChild(w);let y=document.createElement("div");y.innerHTML=`<strong>Originals:</strong> ${Array.isArray(t.original)?t.original.slice(0,6).map(d=>D(d)).join(", "):""}`,n.appendChild(y);let c=document.createElement("a");c.href="strong.html#"+encodeURIComponent(t.strong),c.textContent="Open details",c.style.marginTop="6px",c.target="_blank",n.appendChild(c),o.appendChild(n)}),s.innerHTML="",s.appendChild(o)}catch(r){s.innerHTML="<div>Error: "+String(r)+"</div>"}}function D(e){return e==null?"":String(e).replace(/[&<>"]/g,r=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"})[r])}g.addEventListener("keydown",e=>{e.key==="Enter"&&m()});j.addEventListener("click",m);})();
