(()=>{var x="parallelismus";var S=(function(){try{if(window.__PARALLELISMUS_BASE__)return window.__PARALLELISMUS_BASE__;if(document.currentScript&&document.currentScript.src)return new URL("./",document.currentScript.src).href}catch{}return""})(),b=S+"data/bible.json",l=null,h=null;function E(){return new Promise((r,t)=>{let o=indexedDB.open(x,1);o.onupgradeneeded=i=>{let e=i.target.result;if(e.objectStoreNames.contains("books")||e.createObjectStore("books",{keyPath:"id"}),e.objectStoreNames.contains("chapters")||e.createObjectStore("chapters",{keyPath:"id"}).createIndex("book_id","book_id",{unique:!1}),e.objectStoreNames.contains("verses")||e.createObjectStore("verses",{keyPath:"id"}).createIndex("chapter_id","chapter_id",{unique:!1}),!e.objectStoreNames.contains("verseWords")){let n=e.createObjectStore("verseWords",{keyPath:"id"});n.createIndex("verse_id","verse_id",{unique:!1}),n.createIndex("word_id","word_id",{unique:!1})}if(e.objectStoreNames.contains("words")||e.createObjectStore("words",{keyPath:"strong"}),!e.objectStoreNames.contains("relations")){let n=e.createObjectStore("relations",{keyPath:"id",autoIncrement:!0});n.createIndex("source_id","source_id",{unique:!1}),n.createIndex("target_id","target_id",{unique:!1})}},o.onsuccess=()=>r(o.result),o.onerror=()=>t(o.error)})}function p(r,t,o){return new Promise((i,e)=>{let n=r.transaction(t,"readwrite"),s=n.objectStore(t);for(let c of o)s.put(c);n.oncomplete=()=>i(),n.onerror=()=>e(n.error)})}function w(r,t){return new Promise((o,i)=>{let n=r.transaction(t,"readonly").objectStore(t).count();n.onsuccess=()=>o(n.result),n.onerror=()=>i(n.error)})}function B(r,t){return new Promise((o,i)=>{let e=r.transaction(t,"readwrite");e.objectStore(t).clear(),e.oncomplete=()=>o(),e.onerror=()=>i(e.error)})}async function D(r,t){let o=await w(r,"books"),i=await w(r,"verseWords"),e=await w(r,"words");if(o>0&&i>0&&e>0){t&&t("Database already loaded.");return}if(o>0||i>0||e>0){t&&t("Incomplete database detected, re-downloading\u2026");for(let a of["books","chapters","verses","words","verseWords"])await B(r,a)}t&&t("Downloading bible data\u2026");let n=await fetch(b);if(!n.ok)throw new Error(`Failed to fetch ${b}: ${n.status}`);let s=await n.json();t&&t("Loading books\u2026"),await p(r,"books",s.books),t&&t("Loading chapters\u2026"),await p(r,"chapters",s.chapters),t&&t("Loading verses\u2026"),await p(r,"verses",s.verses),t&&t("Loading words\u2026"),await p(r,"words",s.words),t&&t("Loading verse-words (this may take a moment)\u2026");let c=s.verseWords,u=2e4;for(let a=0;a<c.length;a+=u)await p(r,"verseWords",c.slice(a,a+u)),t&&t(`Loading verse-words\u2026 ${Math.min(a+u,c.length)}/${c.length}`);t&&t("Database ready.")}async function _(r){return l||h||(h=(async()=>(l=await E(),await D(l,r),l))(),h)}function k(r){return new Promise((t,o)=>{let e=l.transaction(r,"readonly").objectStore(r).getAll();e.onsuccess=()=>t(e.result),e.onerror=()=>o(e.error)})}async function m(r){let t=(r||"").trim().toLowerCase();if(!t)return[];let o=await k("words"),i=[];for(let e of o){let n=!1;for(let s of e.translation||[])if(s&&s.toLowerCase().includes(t)){n=!0;break}if(!n){for(let s of e.original||[])if(s&&s.toLowerCase().includes(t)){n=!0;break}}n&&i.push({strong:e.strong,original:e.original,translation:e.translation})}return i}var g=document.getElementById("q"),C=document.getElementById("go"),d=document.getElementById("results"),f=document.getElementById("loading-status");(async()=>{try{await _(t=>{f&&(f.textContent=t)}),f&&(f.style.display="none");let r=new URLSearchParams(location.search);r.get("q")&&(g.value=r.get("q"),y())}catch(r){f&&(f.textContent="DB init failed: "+String(r))}})();async function y(){let r=(g.value||"").trim();if(!r){d.innerHTML="<div>Enter a query</div>";return}d.innerHTML="<div>Searching\u2026</div>";try{let t=await m(r);if(!t||!t.length){d.innerHTML="<div>(no results)</div>";return}let o=document.createElement("ul");t.forEach(i=>{let e=document.createElement("li"),n=document.createElement("div");n.style.fontWeight="600",n.textContent=i.strong,e.appendChild(n);let s=document.createElement("div");s.innerHTML=`<strong>Translations:</strong> ${Array.isArray(i.translation)?i.translation.slice(0,6).map(a=>v(a)).join(", "):""}`,e.appendChild(s);let c=document.createElement("div");c.innerHTML=`<strong>Originals:</strong> ${Array.isArray(i.original)?i.original.slice(0,6).map(a=>v(a)).join(", "):""}`,e.appendChild(c);let u=document.createElement("a");u.href="strong.html#"+encodeURIComponent(i.strong),u.textContent="Open details",u.style.marginTop="6px",u.target="_blank",e.appendChild(u),o.appendChild(e)}),d.innerHTML="",d.appendChild(o)}catch(t){d.innerHTML="<div>Error: "+String(t)+"</div>"}}function v(r){return r==null?"":String(r).replace(/[&<>"]/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"})[t])}g.addEventListener("keydown",r=>{r.key==="Enter"&&y()});C.addEventListener("click",y);})();
