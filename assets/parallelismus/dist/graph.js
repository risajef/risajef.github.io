(()=>{var d="";try{let t=window.location.hostname;d=window.location.origin}catch{d=""}var g=document.getElementById("relationType"),m=document.getElementById("limit"),w=document.getElementById("layout"),$=document.getElementById("refresh"),f=document.getElementById("graph-status"),E=document.getElementById("graph"),a=document.getElementById("loading-status"),s,p=["#38bdf8","#f472b6","#facc15","#4ade80","#a78bfa","#fb7185","#fbbf24","#34d399","#60a5fa"],i=new Map,u=(t,n=!1)=>{f.textContent=t,f.style.color=n?"#f87171":"#94a3b8"},x=t=>t?(i.has(t)||i.set(t,p[i.size%p.length]),i.get(t)):"#94a3b8",b=t=>{let n=[],o=[],r=new Map;return t.forEach(e=>{e.source_id&&!r.has(e.source_id)&&(r.set(e.source_id,!0),n.push({id:e.source_id,label:e.source_label||e.source_id,title:e.source_label||e.source_id,color:"#1d4ed8"})),e.target_id&&!r.has(e.target_id)&&(r.set(e.target_id,!0),n.push({id:e.target_id,label:e.target_label||e.target_id,title:e.target_label||e.target_id,color:"#9333ea"})),o.push({id:`edge-${e.id}`,from:e.source_id,to:e.target_id,label:e.relation_type||"relation",color:{color:x(e.relation_type),opacity:.7},font:{align:"horizontal",size:12,color:"#cbd5f5"},arrows:{to:{enabled:!0,scaleFactor:.6}},smooth:{enabled:!0,type:"dynamic"}})}),{nodes:n,edges:o}},T=t=>{let n=t.length||1,o=Math.max(220,n*10);return t.map((r,e)=>{let l=2*Math.PI*e/n;return{...r,x:o*Math.cos(l),y:o*Math.sin(l),fixed:!0}})},j=t=>t==="circular"?{layout:{improvedLayout:!1},physics:{enabled:!1}}:t==="kamada_kawai"?{layout:{improvedLayout:!0},physics:{enabled:!0,solver:"forceAtlas2Based",stabilization:{fit:!0,iterations:200}}}:{layout:{improvedLayout:!0},physics:{enabled:!0,solver:"barnesHut",stabilization:{fit:!0,iterations:200}}},h=t=>{let n=w.value,o=j(n),r=n==="circular"?T(t.nodes):t.nodes,e={nodes:new vis.DataSet(r),edges:new vis.DataSet(t.edges)};s?(s.setOptions(o),s.setData(e)):s=new vis.Network(E,e,o),s.fit()},y=async()=>{u("Loading graph\u2026");try{let t=parseInt(m.value,10)||500,n=g.value.trim()||null,o=await(void 0)(t,n);if(!Array.isArray(o)||o.length===0){u("No relations found for this filter."),h({nodes:[],edges:[]});return}let r=b(o);h(r),u(`Rendered ${r.nodes.length} nodes and ${r.edges.length} edges.`)}catch(t){console.error(t),u(`Failed to load graph: ${t.message}`,!0)}};(async()=>{try{await(void 0)(t=>{a&&(a.textContent=t)}),a&&(a.style.display="none"),await y()}catch(t){a&&(a.textContent="DB init failed: "+String(t))}})();$.addEventListener("click",()=>y());w.addEventListener("change",()=>{if(!s)return;let t=s.body.data.nodes.get(),n=s.body.data.edges.get();h({nodes:t,edges:n})});})();
